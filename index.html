<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>v87.0 å£°æ³¢é©±åŠ¨ç‰ˆ</title>
    <style>
        body {
            background-color: #000;
            color: #fff;
            font-family: "Microsoft YaHei", sans-serif;
            margin: 0; padding: 0;
            height: 100vh; overflow: hidden;
            user-select: none;
        }

        /* é¡¶éƒ¨çŠ¶æ€æ  */
        #status-bar {
            position: fixed; top: 0; left: 0; width: 100%; height: 30px;
            background: #111; border-bottom: 1px solid #333;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; color: #888; z-index: 100;
        }
        
        /* æ»šåŠ¨å®¹å™¨ */
        #scroll-container {
            position: absolute; top: 30px; left: 0; width: 100%; 
            height: calc(100% - 130px); /* ç•™å‡ºåº•éƒ¨æ§åˆ¶åŒº */
            overflow-y: scroll;
            scroll-behavior: auto; 
        }
        #scroll-container::-webkit-scrollbar { display: none; }

        #content {
            padding: 40vh 5% 800px 5%;
            width: 90%;
            font-size: 55px; 
            line-height: 1.6; 
            text-align: center;
        }
        
        .mirror-on { transform: scaleX(-1); }

        /* åº•éƒ¨æ§åˆ¶åŒº */
        #bottom-panel {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 100px;
            background: #1a1a1a; border-top: 1px solid #333;
            display: flex; flex-direction: column; justify-content: space-evenly;
            z-index: 999; padding: 5px 15px; box-sizing: border-box;
        }

        /* æ»‘å—è¡Œ */
        .slider-row {
            display: flex; align-items: center; justify-content: space-between;
            width: 100%; color: #aaa; font-size: 12px;
        }
        .slider-row label { width: 40px; }
        .slider-row input { flex: 1; margin: 0 10px; }
        .slider-val { width: 30px; text-align: right; color: #fff; }

        /* å¯åŠ¨æŒ‰é’® */
        #btn-start {
            width: 100%; height: 35px;
            background: #0078d7; color: white; border: none; border-radius: 4px;
            font-weight: bold; font-size: 14px;
            margin-top: 5px;
        }
        .running #btn-start { background: #d9534f; }

        /* éŸ³é‡æ¡å¯è§†åŒ– */
        #vol-meter {
            position: absolute; bottom: 100px; left: 0; width: 100%; height: 4px;
            background: #333;
        }
        #vol-bar {
            width: 0%; height: 100%; background: #00E5FF;
            transition: width 0.1s;
        }

        /* ä¾§è¾¹æ‚¬æµ®æŒ‰é’® */
        #side-controls {
            position: fixed; bottom: 110px; right: 10px;
            display: flex; flex-direction: column; gap: 8px; z-index: 998;
        }
        .mini-btn {
            width: 36px; height: 36px; border-radius: 50%;
            background: rgba(50,50,50,0.8); border: 1px solid #666;
            color: #fff; font-size: 10px; font-weight: bold;
            display: flex; align-items: center; justify-content: center;
        }

        /* ç¼–è¾‘å™¨ */
        #editor-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000; flex-direction: column;
        }
        #editor-text {
            flex: 1; width: 100%; background: #111; color: #fff; border: none; padding: 15px; font-size: 18px;
        }
        .editor-header {
             height: 40px; background: #222; display: flex; justify-content: space-between; align-items: center; padding: 0 10px;
        }
    </style>
</head>
<body>

    <div id="status-bar">v87.0 å£°æ³¢é©±åŠ¨ç‰ˆ (è¯·ç‚¹å‡»è“è‰²æŒ‰é’®å¯åŠ¨)</div>
    
    <div id="vol-meter"><div id="vol-bar"></div></div>

    <div id="scroll-container">
        <div id="content"></div>
    </div>

    <div id="side-controls">
        <button class="mini-btn" onclick="openEditor()">ç¨¿</button>
        <button class="mini-btn" onclick="toggleMirror()">é•œ</button>
        <button class="mini-btn" onclick="changeFontSize(5)">+</button>
        <button class="mini-btn" onclick="changeFontSize(-5)">-</button>
        <button class="mini-btn" onclick="reset()">é‡</button>
    </div>

    <div id="bottom-panel">
        <div class="slider-row">
            <label>é€Ÿåº¦</label>
            <input type="range" id="speed-slider" min="0.5" max="5.0" step="0.1" value="1.5" oninput="updateSpeed(this.value)">
            <span id="speed-val" class="slider-val">1.5</span>
        </div>
        <div class="slider-row">
            <label>çµæ•</label>
            <input type="range" id="sens-slider" min="1" max="50" step="1" value="15" oninput="updateSens(this.value)">
            <span id="sens-val" class="slider-val">15</span>
        </div>
        <button id="btn-start" onclick="toggleAudio()">å¯åŠ¨å£°æ§å¼•æ“</button>
    </div>

    <div id="editor-overlay">
        <div class="editor-header">
            <button onclick="closeEditor()" style="color:#fff;background:none;border:none;">å–æ¶ˆ</button>
            <span style="color:#888;">ç¼–è¾‘æ–‡ç¨¿</span>
            <button onclick="saveEditor()" style="color:#00E5FF;background:none;border:none;">å®Œæˆ</button>
        </div>
        <textarea id="editor-text"></textarea>
    </div>

    <script>
        var rawText = `è¿™æ˜¯v87å£°æ³¢é©±åŠ¨ç‰ˆã€‚
è§£å†³å›½å†…å®‰å“æ— æ³•å®æ—¶è¯†åˆ«çš„ç—›ç‚¹ã€‚
å·¥ä½œåŸç†ï¼š
å®ƒä¸å†â€œå¬â€ä½ è¯´çš„æ˜¯ä»€ä¹ˆå­—ï¼Œ
è€Œæ˜¯â€œæ„ŸçŸ¥â€ä½ æœ‰æ²¡æœ‰åœ¨è¯´è¯ã€‚
ä½¿ç”¨æ–¹æ³•ï¼š
1. ç‚¹å‡»ä¸‹æ–¹ã€å¯åŠ¨å£°æ§å¼•æ“ã€‘ã€‚
2. å…è®¸éº¦å…‹é£æƒé™ (å¿…é¡»HTTPS)ã€‚
3. å¯¹ç€æ‰‹æœºè¯´è¯ã€‚
4. æœ‰å£°éŸ³ -> æ–‡å­—æ»šåŠ¨ã€‚
5. æ²¡å£°éŸ³ -> æ–‡å­—åœæ­¢ã€‚
è°ƒèŠ‚æŠ€å·§ï¼š
- å¦‚æœå‘¨å›´ç¯å¢ƒåµï¼ŒæŠŠã€çµæ•ã€‘è°ƒé«˜(æ•°å€¼å˜å¤§)ã€‚
- å¦‚æœæ»šå¾—å¤ªæ…¢ï¼ŒæŠŠã€é€Ÿåº¦ã€‘è°ƒé«˜ã€‚
å½»åº•å‘Šåˆ«è¾“å…¥æ³•çš„å¡é¡¿ã€‚`;

        // æ ¸å¿ƒå‚æ•°
        var isRunning = false;
        var audioContext = null;
        var analyser = null;
        var microphone = null;
        var scriptProcessor = null;
        
        // è¿åŠ¨å‚æ•°
        var baseSpeed = 1.5;
        var sensitivity = 15; // é˜ˆå€¼ï¼Œè¶Šå°è¶Šçµæ•
        var currentScrollSpeed = 0;
        var container = document.getElementById('scroll-container');

        function init() { render(); }

        function render() {
            // ç®€å•æ¸²æŸ“ï¼Œä¸éœ€è¦æ‹†è¯äº†ï¼Œå› ä¸ºæ˜¯çº¯æ»šåŠ¨
            document.getElementById('content').innerHTML = rawText.replace(/\n/g, '<br>');
        }

        // â˜…â˜…â˜… æ ¸å¿ƒï¼šWeb Audio API å£°æ³¢æ£€æµ‹ â˜…â˜…â˜…
        async function toggleAudio() {
            if (isRunning) {
                stopAudio();
            } else {
                await startAudio();
            }
        }

        async function startAudio() {
            try {
                // 1. è·å–éº¦å…‹é£ (ä»…è·å–éŸ³é‡æµï¼Œä¸éœ€è¦ Google æœåŠ¡)
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: false });
                
                // 2. åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                analyser = audioContext.createAnalyser();
                microphone = audioContext.createMediaStreamSource(stream);
                scriptProcessor = audioContext.createScriptProcessor(2048, 1, 1);

                // 3. è¿æ¥èŠ‚ç‚¹
                analyser.smoothingTimeConstant = 0.8;
                analyser.fftSize = 1024;
                microphone.connect(analyser);
                analyser.connect(scriptProcessor);
                scriptProcessor.connect(audioContext.destination);

                // 4. ç›‘å¬éŸ³é‡
                scriptProcessor.onaudioprocess = function() {
                    const array = new Uint8Array(analyser.frequencyBinCount);
                    analyser.getByteFrequencyData(array);
                    
                    // è®¡ç®—å¹³å‡éŸ³é‡
                    let values = 0;
                    const length = array.length;
                    for (let i = 0; i < length; i++) {
                        values += array[i];
                    }
                    const average = values / length;

                    // æ›´æ–°å¯è§†åŒ–æ¡
                    document.getElementById('vol-bar').style.width = (average * 2) + "%";

                    // â˜…â˜…â˜… æ ¸å¿ƒé€»è¾‘ï¼šæœ‰å£°éŸ³å°±èµ°ï¼Œæ²¡å£°éŸ³å°±åœ â˜…â˜…â˜…
                    if (average > sensitivity) {
                        // å£°éŸ³å¤Ÿå¤§ï¼Œå…¨é€Ÿå‰è¿›
                        targetSpeed = baseSpeed;
                        document.getElementById('status-bar').style.color = "#00E5FF";
                        document.getElementById('status-bar').innerText = "ğŸ”Š æ£€æµ‹åˆ°è¯­éŸ³ - æ»šåŠ¨ä¸­...";
                    } else {
                        // æ²¡å£°éŸ³ï¼Œæ…¢æ…¢åœä¸‹
                        targetSpeed = 0;
                        document.getElementById('status-bar').style.color = "#888";
                        document.getElementById('status-bar').innerText = "ğŸ’¤ ç­‰å¾…è¯­éŸ³...";
                    }

                    // å¹³æ»‘è¿‡æ¸¡
                    currentScrollSpeed += (targetSpeed - currentScrollSpeed) * 0.1;
                    
                    // æ‰§è¡Œæ»šåŠ¨
                    if (currentScrollSpeed > 0.1) {
                        container.scrollTop += currentScrollSpeed;
                    }
                };

                // UI æ›´æ–°
                isRunning = true;
                document.getElementById('btn-start').innerText = "ğŸ›‘ åœæ­¢å¼•æ“";
                document.getElementById('bottom-panel').classList.add('running');
                
                // ä¿æŒå±å¹•å¸¸äº® (ç®€å•çš„è§†é¢‘å¾ªç¯é»‘é­”æ³•)
                enableNoSleep();

            } catch (e) {
                alert("æ— æ³•å¯åŠ¨éº¦å…‹é£ï¼\n1. è¯·ç¡®ä¿æ˜¯ HTTPS é“¾æ¥ (GitHub Pages)ã€‚\n2. è¯·åœ¨å¼¹çª—ä¸­å…è®¸éº¦å…‹é£æƒé™ã€‚\né”™è¯¯ä¿¡æ¯: " + e);
            }
        }

        function stopAudio() {
            if (audioContext) audioContext.close();
            if (microphone) microphone.disconnect();
            if (scriptProcessor) scriptProcessor.disconnect();
            
            isRunning = false;
            document.getElementById('btn-start').innerText = "å¯åŠ¨å£°æ§å¼•æ“";
            document.getElementById('bottom-panel').classList.remove('running');
            document.getElementById('status-bar').innerText = "å·²åœæ­¢";
            document.getElementById('vol-bar').style.width = "0%";
        }

        // --- é˜²é”å±é»‘é­”æ³• ---
        function enableNoSleep() {
            // åˆ›å»ºä¸€ä¸ªå¾®å°çš„å¾ªç¯æ’­æ”¾è§†é¢‘ï¼Œæ¬ºéª—å®‰å“ç³»ç»Ÿä¸é”å±
            let video = document.createElement('video');
            video.setAttribute('playsinline', '');
            video.setAttribute('src', 'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAQBAAAABAAAABgd1ZGl0YW1sPAAAAAA=');
            video.style.display = 'none';
            document.body.appendChild(video);
            video.play().catch(()=>{});
        }

        // --- UI Helper ---
        function updateSpeed(val) {
            baseSpeed = parseFloat(val);
            document.getElementById('speed-val').innerText = baseSpeed.toFixed(1);
        }
        function updateSens(val) {
            sensitivity = parseInt(val);
            document.getElementById('sens-val').innerText = val;
        }
        function changeFontSize(d) {
            var el = document.getElementById('content');
            var s = parseInt(window.getComputedStyle(el).fontSize);
            el.style.fontSize = (s + d) + "px";
        }
        function toggleMirror() { document.getElementById('content').classList.toggle("mirror-on"); }
        function openEditor() { document.getElementById('editor-text').value = rawText; document.getElementById('editor-overlay').style.display = 'flex'; }
        function closeEditor() { document.getElementById('editor-overlay').style.display = 'none'; }
        function saveEditor() { 
            var val = document.getElementById('editor-text').value; 
            if (val) { rawText = val; render(); closeEditor(); } 
        }
        function reset() { container.scrollTop = 0; }

        init();
    </script>
</body>
</html>